(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1290:()=>{},2727:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,1290,23)),Promise.resolve().then(s.bind(s,5970)),Promise.resolve().then(s.bind(s,4929)),Promise.resolve().then(s.t.bind(s,2619,23)),Promise.resolve().then(s.t.bind(s,1402,23)),Promise.resolve().then(s.t.bind(s,3749,23)),Promise.resolve().then(s.t.bind(s,5004,23)),Promise.resolve().then(s.t.bind(s,9621,23))},4929:(e,t,s)=>{"use strict";s.d(t,{ErrorBoundary:()=>a});var r=s(5155),l=s(2115);class a extends l.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("[ErrorBoundary] Caught error:",e),console.error("[ErrorBoundary] Component stack:",t.componentStack)}render(){if(this.state.hasError){var e;return this.props.fallback?this.props.fallback:(0,r.jsxs)("div",{className:"p-4 rounded-xl bg-red-50 border border-red-100 text-center",children:[(0,r.jsx)("p",{className:"text-red-600 font-medium text-sm",children:"發生錯誤"}),(0,r.jsx)("p",{className:"text-red-400 text-xs mt-1",children:(null==(e=this.state.error)?void 0:e.message)||"未知錯誤"}),(0,r.jsx)("button",{onClick:()=>this.setState({hasError:!1,error:null}),className:"mt-3 px-4 py-1.5 bg-red-100 hover:bg-red-200 text-red-600 text-xs rounded-lg transition-colors",children:"重試"})]})}return this.props.children}constructor(e){super(e),this.state={hasError:!1,error:null}}}},5970:(e,t,s)=>{"use strict";s.d(t,{default:()=>b});var r=s(5155),l=s(2115),a=s(5740),o=s(9559),i=s(5229),n=s(8192),d=s(6154),c=s(5299),x=s(6132),h=s(8085),m=s(4486),u=s(1408),p=s(856);function b(){let[e,t]=(0,l.useState)(!1),[s,b]=(0,l.useState)([]),[f,g]=(0,l.useState)(""),[w,j]=(0,l.useState)(!1),[v,N]=(0,l.useState)(null),y=(0,l.useRef)(null),k=(0,l.useRef)(null);(0,l.useEffect)(()=>{y.current&&(y.current.scrollTop=y.current.scrollHeight)},[s,w]);let C=async e=>{if(e.preventDefault(),!f.trim()||w)return;let t={id:Date.now().toString(),role:"user",content:f.trim()};b(e=>[...e,t]),g(""),j(!0),N(null),k.current=new AbortController;try{var r;let e=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...s,t].map(e=>({role:e.role,content:e.content}))}),signal:k.current.signal});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"HTTP ".concat(e.status))}let l=null==(r=e.body)?void 0:r.getReader(),a=new TextDecoder,o="",i={id:(Date.now()+1).toString(),role:"assistant",content:""};if(b(e=>[...e,i]),l)for(;;){let{done:e,value:t}=await l.read();if(e)break;for(let e of a.decode(t,{stream:!0}).split("\n"))if(e.startsWith("0:"))try{let t=JSON.parse(e.slice(2));o+=t,b(e=>e.map(e=>e.id===i.id?{...e,content:o}:e))}catch(e){}}}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;N(e instanceof Error?e.message:"發生未知錯誤"),console.error("[TaiCalcChat] Error:",e)}finally{j(!1),k.current=null}},E=s.some(e=>"user"===e.role);return e?(0,r.jsx)(u.N,{children:(0,r.jsxs)(m.P.div,{initial:{opacity:0,y:40,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:40,scale:.95},className:"fixed bottom-6 right-6 w-[380px] h-[600px] glass-panel rounded-3xl flex flex-col z-50 overflow-hidden shadow-2xl",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-r from-indigo-600 via-purple-600 to-rose-500 text-white px-5 py-4 flex justify-between items-center shadow-md",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"p-1.5 bg-white/20 rounded-lg backdrop-blur-sm",children:(0,r.jsx)(a.A,{className:"w-4 h-4"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-bold text-sm tracking-wide",children:"AI 財務顧問"}),(0,r.jsxs)("div",{className:"text-[10px] opacity-80 flex items-center gap-1",children:[(0,r.jsx)("span",{className:"w-1.5 h-1.5 bg-emerald-400 rounded-full animate-pulse"}),"Gemini 2.0"]})]})]}),(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsx)("button",{onClick:()=>{k.current&&k.current.abort(),b([]),N(null)},className:"p-2 hover:bg-white/20 rounded-full transition-colors",title:"清除對話",children:(0,r.jsx)(o.A,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>t(!1),className:"p-2 hover:bg-white/20 rounded-full transition-colors",title:"關閉視窗",children:(0,r.jsx)(i.A,{className:"w-4 h-4"})})]})]}),(0,r.jsxs)("div",{ref:y,className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50/50",children:[!E&&!v&&(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center space-y-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-2xl flex items-center justify-center",children:(0,r.jsx)(n.A,{className:"w-8 h-8 text-indigo-500"})}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("h3",{className:"font-bold text-slate-800",children:"您好，我是 TaiCalc AI"}),(0,r.jsx)("p",{className:"text-sm text-slate-500 max-w-[220px] mx-auto",children:"我可以幫您計算薪資結構、稅務規劃或房貸試算"})]}),(0,r.jsx)("div",{className:"w-full space-y-2 px-4",children:["月薪 5 萬，適合買多少錢的房？","我該自提勞退嗎？","年薪 120 萬要繳多少稅？"].map(e=>(0,r.jsxs)("button",{onClick:()=>{g(e),setTimeout(()=>{let e=document.getElementById("chat-form");e&&e.requestSubmit()},0)},className:"w-full px-4 py-3 bg-white border border-slate-100 rounded-xl text-left text-xs text-slate-600 hover:border-indigo-300 hover:text-indigo-600 hover:shadow-sm transition-all truncate",children:[(0,r.jsx)(d.A,{className:"inline w-3 h-3 mr-2 text-amber-500"}),e]},e))})]}),s.map(e=>(0,r.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,r.jsx)("div",{className:"max-w-[85%] px-4 py-3 rounded-2xl text-sm leading-relaxed shadow-sm ".concat("user"===e.role?"bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-br-none":"bg-white border border-slate-100 text-slate-700 rounded-bl-none prose prose-sm max-w-none"),children:"assistant"===e.role?(0,r.jsx)(p.oz,{children:e.content||"..."}):e.content})},e.id)),w&&(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsxs)("div",{className:"bg-white/50 border border-slate-100 px-4 py-3 rounded-2xl rounded-bl-none flex items-center gap-2 text-xs text-slate-500",children:[(0,r.jsx)(c.A,{className:"w-3 h-3 animate-spin text-indigo-500"}),"正在分析您的財務數據..."]})}),v&&(0,r.jsxs)("div",{className:"mx-2 p-3 bg-red-50 border border-red-100 rounded-xl text-xs text-red-600 flex items-center justify-between gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.A,{className:"w-4 h-4 flex-shrink-0"}),(0,r.jsx)("span",{children:v})]}),(0,r.jsx)("button",{onClick:()=>{N(null);let e=[...s].reverse().find(e=>"user"===e.role);e&&(g(e.content),b(t=>t.filter(t=>t.id!==e.id)))},className:"p-1.5 hover:bg-red-100 rounded-lg transition-colors",title:"重試",children:(0,r.jsx)(o.A,{className:"w-3 h-3"})})]})]}),(0,r.jsx)("form",{id:"chat-form",onSubmit:C,className:"p-4 bg-white/80 backdrop-blur-md border-t border-white/50",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:f,onChange:e=>{g(e.target.value)},placeholder:"輸入您的問題...",className:"glass-input w-full px-4 py-3 rounded-xl text-sm placeholder:text-slate-400",disabled:w}),(0,r.jsx)("button",{type:"submit",disabled:w||!f.trim(),className:"px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl shadow-lg shadow-indigo-500/20 hover:shadow-indigo-500/30 active:scale-95 transition-all disabled:opacity-50 disabled:shadow-none",title:"傳送訊息",children:(0,r.jsx)(h.A,{className:"w-4 h-4"})})]})})]})}):(0,r.jsxs)("div",{className:"fixed bottom-6 right-6 z-50",children:[(0,r.jsx)("div",{className:"absolute inset-0 w-16 h-16 -m-1",children:(0,r.jsx)("span",{className:"absolute inset-0 rounded-full bg-gradient-to-r from-indigo-500 to-purple-600 opacity-20 animate-ping"})}),(0,r.jsxs)(m.P.button,{initial:{scale:0},animate:{scale:1},whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>t(!0),className:"relative w-16 h-16 glass-card border-none bg-gradient-to-br from-indigo-600 via-purple-600 to-rose-500 text-white rounded-2xl shadow-2xl flex items-center justify-center hover:shadow-indigo-500/40 transition-shadow",title:"開啟 AI 財務顧問",children:[(0,r.jsx)(a.A,{className:"w-7 h-7"}),(0,r.jsx)("span",{className:"absolute -top-2 -right-2 bg-indigo-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full border border-white shadow-sm",children:"AI"})]})]})}}},e=>{e.O(0,[937,614,497,297,854,441,255,358],()=>e(e.s=2727)),_N_E=e.O()}]);