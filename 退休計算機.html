<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§é€€ä¼‘è¦åŠƒ Pro | å•†æ¥­ç´šç²¾ç®—å¼•æ“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; color: #1e293b; }
        
        /* å¡ç‰‡é¢¨æ ¼ */
        .card { 
            background: white; 
            border-radius: 1rem; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03); 
            border: 1px solid #e2e8f0; 
            transition: transform 0.2s ease-in-out;
        }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }

        /* è¼¸å…¥æ¡†å„ªåŒ– */
        .input-label { font-size: 0.875rem; font-weight: 600; color: #475569; margin-bottom: 0.5rem; display: block; }
        .input-field { 
            width: 100%; padding: 0.75rem 1rem; 
            border: 1px solid #cbd5e1; border-radius: 0.5rem; 
            font-size: 1rem; font-weight: 500;
            transition: all 0.2s; background-color: #f8fafc; color: #0f172a;
        }
        .input-field:focus { outline: none; border-color: #2563eb; background-color: #fff; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        
        /* æ•¸å­—æ¨™ç±¤ Badge */
        .step-badge { 
            display: inline-flex; align-items: center; justify-content: center; 
            width: 2rem; height: 2rem; border-radius: 9999px; 
            font-weight: bold; margin-right: 0.75rem; font-size: 0.875rem; 
        }

        /* å®˜æ–¹é€£çµæŒ‰éˆ• */
        .link-btn {
            display: inline-flex; align-items: center; padding: 0.5rem 0.75rem;
            background-color: #eff6ff; color: #2563eb; 
            border: 1px solid #bfdbfe; border-radius: 0.5rem;
            font-size: 0.875rem; font-weight: 500; text-decoration: none;
            transition: all 0.2s; width: 100%; justify-content: center;
        }
        .link-btn:hover { background-color: #dbeafe; }

        /* æ»‘æ¡¿æ¨£å¼ */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #f59e0b; cursor: pointer; margin-top: -8px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #cbd5e1; border-radius: 2px; }
    </style>
</head>
<body class="py-8 px-4 sm:px-6">

    <div class="max-w-7xl mx-auto space-y-8">
        
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-extrabold text-slate-800 tracking-tight mb-2">
                æ™ºæ…§é€€ä¼‘è¦åŠƒ <span class="text-blue-600">Pro</span>
            </h1>
            <p class="text-slate-500 font-medium">
                é›™è»Œå¼•æ“ï¼šåŒæ™‚è™•ç†ã€Œå‹ä¿å¹´è³‡ã€èˆ‡ã€Œå‹é€€å¸³æˆ¶ã€
            </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <div class="lg:col-span-4 space-y-6">
                
                <div class="card p-6 border-t-4 border-blue-500">
                    <div class="flex items-center mb-4">
                        <span class="step-badge bg-blue-100 text-blue-600">1</span>
                        <h2 class="text-lg font-bold text-slate-800">å·¥ä½œèƒŒæ™¯èˆ‡å¹´è³‡</h2>
                    </div>
                    
                    <div class="mb-5 bg-blue-50 rounded-lg p-3 border border-blue-100">
                        <div class="text-xs text-blue-600 mb-2 font-medium">è³‡æ–™å“ªè£¡æ‰¾ï¼Ÿ</div>
                        <a href="https://edesk.bli.gov.tw/na/" target="_blank" class="link-btn">
                            <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                            é–‹å•Ÿå‹ä¿å±€ e åŒ–ç³»çµ±
                        </a>
                    </div>

                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="input-label">ç›®å‰å¹´é½¡</label>
                                <input type="number" id="age" value="50" class="input-field text-center font-bold">
                            </div>
                            <div>
                                <label class="input-label">å‹ä¿æŠ•ä¿å¹´è³‡</label>
                                <div class="relative">
                                    <input type="number" id="workYears" value="28" class="input-field text-center">
                                    <span class="absolute right-3 top-3 text-slate-400 text-xs">å¹´</span>
                                </div>
                            </div>
                        </div>
                        <p class="text-[11px] text-slate-500 -mt-2">ğŸ’¡ è«‹å¡«ã€Œå‹ä¿å¹´è³‡ã€ï¼ˆå«å·¥æœƒï¼‰ï¼Œæ­¤æ•¸å­—ç”¨æ–¼è¨ˆç®—å‹ä¿å¹´é‡‘ã€‚</p>

                        <div>
                            <label class="input-label">ç›®å‰æœˆè–ª (æŠ•ä¿è–ªè³‡)</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-slate-400">$</span>
                                <input type="number" id="salary" value="45800" class="input-field pl-8 font-bold text-slate-700">
                            </div>
                        </div>

                        <div class="pt-2 border-t border-slate-200">
                            <label class="input-label text-indigo-600">å‹å·¥é€€ä¼‘é‡‘å€‹äººå°ˆæˆ¶é‡‘é¡</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-slate-400">$</span>
                                <input type="number" id="lpBalance" value="1200000" class="input-field pl-8 font-bold text-indigo-700 bg-indigo-50 border-indigo-200">
                            </div>
                            <p class="text-[11px] text-orange-600 mt-1.5 font-medium">
                               âš ï¸ è«‹å¡«å¯¦éš›æŸ¥è©¢åˆ°çš„é‡‘é¡ã€‚<br>
                                å› ç‚ºå‹é€€æ–°åˆ¶è¼ƒæ™šé–‹å§‹ï¼Œé‡‘é¡èˆ‡å‹ä¿å¹´è³‡é€šå¸¸ä¸å°ç­‰ï¼Œè«‹ç›´æ¥å¡«å…¥å¸³æˆ¶é¤˜é¡æœ€æº–ã€‚
                            </p>
                        </div>
                    </div>
                </div>

                <div class="card p-6 border-t-4 border-orange-500">
                    <div class="flex items-center mb-4">
                        <span class="step-badge bg-orange-100 text-orange-600">2</span>
                        <h2 class="text-lg font-bold text-slate-800">é€€ä¼‘ç›®æ¨™è¨­å®š</h2>
                    </div>
                    
                    <div class="space-y-6">
                        <div>
                            <div class="flex justify-between items-end mb-2">
                                <label class="input-label mb-0">é è¨ˆé€€ä¼‘å¹´é½¡</label>
                                <span class="text-2xl font-bold text-orange-600" id="retireAgeDisplay">65æ­²</span>
                            </div>
                            <input type="range" id="retireAge" min="50" max="75" value="65" step="1">
                        </div>
                        <div>
                            <label class="input-label">é€€ä¼‘å¾Œæ¯æœˆæƒ³èŠ±å¤šå°‘ï¼Ÿ(ç¾å€¼)</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-slate-400">$</span>
                                <input type="number" id="targetExpense" value="40000" class="input-field pl-8">
                            </div>
                            <p class="text-[10px] text-orange-500 mt-1.5">*ç³»çµ±æœƒè‡ªå‹•è¨ˆç®—é€šè†¨å¾Œçš„æœªä¾†é‡‘é¡</p>
                        </div>
                    </div>
                </div>

                <div class="card p-6 border-t-4 border-emerald-500">
                    <div class="flex items-center mb-4">
                        <span class="step-badge bg-emerald-100 text-emerald-600">3</span>
                        <h2 class="text-lg font-bold text-slate-800">è‡ªä¸»æŠ•è³‡éƒ¨ä½</h2>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="input-label">ç›®å‰ç´¯ç©è³‡ç”¢ (è‚¡ç¥¨/å­˜æ¬¾)</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-slate-400">$</span>
                                <input type="number" id="currentAssets" value="500000" class="input-field pl-8">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="input-label">æ¯æœˆå®šæœŸå®šé¡</label>
                                <div class="relative">
                                    <span class="absolute left-2 top-3 text-slate-400 text-xs">$</span>
                                    <input type="number" id="monthlyInvest" value="5000" class="input-field pl-6">
                                </div>
                            </div>
                            <div>
                                <label class="input-label">å¹´åŒ–å ±é…¬ç‡(%)</label>
                                <input type="number" id="roi" value="5" class="input-field text-center">
                            </div>
                        </div>
                    </div>
                </div>

                <button id="calcBtn" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-4 rounded-xl shadow-lg transition transform hover:scale-[1.01] active:scale-[0.98]">
                    é–‹å§‹ç²¾ç®—åˆ†æ
                </button>
            </div>

            <div class="lg:col-span-8 space-y-6">
                
                <div class="card p-6 md:p-8 bg-white">
                    <div class="flex justify-between items-center border-b border-slate-100 pb-4 mb-6">
                        <h3 class="text-xl font-bold text-slate-800">é€€ä¼‘æœˆç¾é‡‘æµé ä¼° (Income Stream)</h3>
                        <span class="text-xs font-medium bg-slate-100 text-slate-500 px-2 py-1 rounded">å–®ä½ï¼šæ–°å°å¹£/æœˆ</span>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center mb-8">
                        <div class="p-4 rounded-xl bg-blue-50 border border-blue-100 hover:bg-blue-100 transition-colors flex flex-col justify-between">
                            <div>
                                <div class="text-xs font-bold text-blue-500 uppercase tracking-wider mb-1">å‹ä¿å¹´é‡‘ (LI)</div>
                                <div class="text-2xl font-bold text-blue-700" id="disp_li">--</div>
                                <div class="text-[10px] text-blue-400 mt-2">ä¾ã€Œå‹ä¿å¹´è³‡ã€è¨ˆç®—</div>
                            </div>
                        </div>
                        <div class="p-4 rounded-xl bg-indigo-50 border border-indigo-100 hover:bg-indigo-100 transition-colors flex flex-col justify-between">
                            <div>
                                <div class="text-xs font-bold text-indigo-500 uppercase tracking-wider mb-1">å‹é€€æœˆé ˜ (LP)</div>
                                <div class="text-2xl font-bold text-indigo-700" id="disp_lp">--</div>
                                <div class="text-[10px] text-indigo-400 mt-1">ä¾ã€Œå€‹äººå°ˆæˆ¶é‡‘é¡ã€æ¨ç®—</div>
                            </div>
                            <div class="mt-3 pt-2 border-t border-indigo-200/60">
                                <div class="flex justify-between items-center text-xs">
                                    <span class="text-indigo-500 font-medium">ç´¯ç©å°ˆæˆ¶ç¸½é¡</span>
                                    <span class="font-bold text-indigo-800" id="disp_lp_lump">--</span>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 rounded-xl bg-emerald-50 border border-emerald-100 hover:bg-emerald-100 transition-colors flex flex-col justify-between">
                            <div>
                                <div class="text-xs font-bold text-emerald-500 uppercase tracking-wider mb-1">è‡ªä¸»æŠ•è³‡ (Self)</div>
                                <div class="text-2xl font-bold text-emerald-700" id="disp_self">--</div>
                                <div class="text-[10px] text-emerald-400 mt-2">æœˆè¤‡åˆ©æ»¾å­˜ + å¹´é‡‘æé ˜</div>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col md:flex-row items-center justify-between bg-slate-50 rounded-2xl p-6 border border-slate-200">
                        <div class="text-center md:text-left mb-4 md:mb-0">
                            <div class="text-sm text-slate-500 font-medium">é ä¼°ç¸½æœˆæ”¶å…¥ (Total Income)</div>
                            <div class="text-4xl font-extrabold text-slate-800 tracking-tight mt-1" id="disp_totalIncome">--</div>
                        </div>
                        
                        <div class="hidden md:block h-12 w-px bg-slate-300 mx-8"></div>
                        <div class="md:hidden w-full h-px bg-slate-300 my-4"></div>

                        <div class="text-center md:text-right">
                            <div class="text-sm text-slate-500 font-medium">ç›®æ¨™æœˆæ”¯å‡º (Target) <span class="text-xs text-orange-500 bg-orange-50 px-1 rounded ml-1">å«é€šè†¨</span></div>
                            <div class="text-3xl font-bold text-slate-600 mt-1" id="disp_target">--</div>
                        </div>
                    </div>

                    <div id="gapCard" class="mt-4 p-5 rounded-xl border transition-all duration-300">
                        <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                            <div class="flex items-start">
                                <div id="gapIcon" class="text-2xl mr-3">ğŸ¤”</div>
                                <div>
                                    <h4 class="font-bold text-lg" id="gapTitle">åˆ†æä¸­...</h4>
                                    <p class="text-sm mt-1 opacity-90" id="gapDesc">è«‹è¼¸å…¥è³‡æ–™é–‹å§‹è¨ˆç®—</p>
                                </div>
                            </div>
                            <div class="bg-white/50 px-4 py-2 rounded-lg text-right min-w-[160px]">
                                <div class="text-xs opacity-70 font-medium mb-1">å»ºè­°æ¯æœˆå¢é¡å„²è“„</div>
                                <div class="text-2xl font-bold" id="disp_neededSave">--</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card p-6">
                    <h3 class="font-bold text-slate-700 mb-4 text-sm">è³‡ç”¢ç´¯ç©è·¯å¾‘æ¨¡æ“¬ (Asset Growth Path)</h3>
                    <div class="h-80 w-full">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>
                
                <div class="text-[11px] text-slate-400 text-center leading-relaxed px-4">
                    * å‹ä¿è¨ˆç®—ï¼šæ¡è¨ˆè¼¸å…¥ä¹‹å‹ä¿å¹´è³‡ï¼Œä¸¦é€²è¡Œ A/B å¼æ“‡å„ªèˆ‡å±•å»¶/æ¸›é¡è¨ˆç®—ã€‚<br>
                    * å‹é€€è¨ˆç®—ï¼šä»¥æ‚¨è¼¸å…¥çš„ã€Œå€‹äººå°ˆæˆ¶é‡‘é¡ã€ç‚ºèµ·é»ï¼ŒåŠ ä¸Šæœªä¾†å·¥ä½œæœŸé–“çš„é›‡ä¸»ææ’¥(6%)è¤‡åˆ©æ»¾å­˜ã€‚<br>
                    * æœ¬ç³»çµ±æ¡ç”¨æœˆè¤‡åˆ©è¨ˆç®—ï¼Œé€šè†¨ç‡é è¨­ç‚º 2%ï¼Œé€€ä¼‘å¾Œé¤˜å‘½å‡è¨­ç‚º 20 å¹´ã€‚<br>
                    * ******* DESIGNED~å¾· *******
                </div>
            </div>
        </div>
    </div>

    <script>
    const PensionEngine = {
        CONSTANTS: {
            LI_CAP: 45800,        // å‹ä¿æŠ•ä¿è–ªè³‡ä¸Šé™
            LP_CAP: 150000,       // å‹é€€æœˆæç¹³å·¥è³‡ä¸Šé™
            INFLATION: 0.02,      // é•·æœŸé€šè†¨ç‡
            LP_RETURN: 0.03,      // å‹é€€åŸºé‡‘é æœŸå¹´åŒ–å ±é…¬ç‡
            RETIRE_LIFE_YEARS: 20,// é€€ä¼‘å¾Œå¹³å‡é¤˜å‘½
            SAFE_RATE: 0.03       // é€€ä¼‘å¾Œè³‡é‡‘é‹ç”¨çš„å®‰å…¨å ±é…¬ç‡
        },

        fv: function(rate, nper, pmt, pv) {
            if (rate === 0) return pv + pmt * nper;
            const factor = Math.pow(1 + rate, nper);
            return pv * factor + pmt * (factor - 1) / rate;
        },

        pmt: function(rate, nper, pv, fv = 0) {
            if (rate === 0) return -(pv + fv) / nper;
            const pvFactor = Math.pow(1 + rate, nper);
            return (rate * (fv + pv * pvFactor)) / (pvFactor - 1);
        },

        pv: function(rate, nper, pmt) {
            if (rate === 0) return -pmt * nper;
            return -pmt * (1 - Math.pow(1 + rate, -nper)) / rate;
        },

        // 1. å‹ä¿ (Old Age Benefit) - çœ‹å¹´è³‡
        calcLaborInsurance: function(salary, workYears, currentAge, retireAge) {
            const insuredSalary = Math.min(salary, this.CONSTANTS.LI_CAP);
            const futureYears = Math.max(0, retireAge - currentAge);
            const totalYears = workYears + futureYears; // å‹ä¿å¹´è³‡æŒçºŒç´¯ç©

            // Aå¼èˆ‡Bå¼æ“‡å„ª
            const formulaA = (insuredSalary * totalYears * 0.00775) + 3000;
            const formulaB = insuredSalary * totalYears * 0.0155;
            const baseAmount = Math.max(formulaA, formulaB);

            // å±•å»¶èˆ‡æ¸›é¡
            let ageFactor = 1;
            const diffYears = retireAge - 65;
            if (diffYears < 0) {
                const reduce = Math.min(5, Math.abs(diffYears));
                ageFactor = 1 - (reduce * 0.04);
            } else if (diffYears > 0) {
                const increase = Math.min(5, diffYears);
                ageFactor = 1 + (increase * 0.04);
            }

            return Math.round(baseAmount * ageFactor);
        },

        // 2. å‹é€€ (Labor Pension) - çœ‹éŒ¢
        calcLaborPension: function(salary, currentAge, retireAge, currentLpBalance) {
            const cappedSalary = Math.min(salary, this.CONSTANTS.LP_CAP);
            const monthlyContrib = cappedSalary * 0.06; 
            const yearsToRetire = Math.max(0, retireAge - currentAge);
            const monthsToRetire = yearsToRetire * 12;
            const monthlyRate = this.CONSTANTS.LP_RETURN / 12;

            // ç´¯ç©æœŸï¼šå¾ã€Œè¼¸å…¥çš„ç¾æœ‰é¤˜é¡ã€é–‹å§‹æ»¾ï¼ŒåŠ ä¸Šã€Œæœªä¾†çš„æ–°ææ’¥ã€
            const fvPast = currentLpBalance * Math.pow(1 + monthlyRate, monthsToRetire);
            const fvFuture = this.fv(monthlyRate, monthsToRetire, monthlyContrib, 0);
            const totalLumpSum = fvPast + fvFuture;

            // æé ˜æœŸ
            const retireMonths = this.CONSTANTS.RETIRE_LIFE_YEARS * 12;
            const monthlyDrawdown = Math.abs(this.pmt(monthlyRate, retireMonths, totalLumpSum));

            return {
                lumpSum: Math.round(totalLumpSum),
                monthly: Math.round(monthlyDrawdown)
            };
        },

        // 3. è‡ªä¸»æŠ•è³‡
        calcInvestment: function(currentAssets, monthlyInvest, yearsToRetire, annualROI) {
            const monthsToRetire = yearsToRetire * 12;
            const monthlyRate = annualROI / 12;
            const fvCurrent = currentAssets * Math.pow(1 + monthlyRate, monthsToRetire);
            const fvMonthly = this.fv(monthlyRate, monthsToRetire, monthlyInvest, 0);
            const totalLumpSum = fvCurrent + fvMonthly;
            
            const safeMonthlyRate = this.CONSTANTS.SAFE_RATE / 12;
            const retireMonths = this.CONSTANTS.RETIRE_LIFE_YEARS * 12;
            const monthlyDrawdown = Math.abs(this.pmt(safeMonthlyRate, retireMonths, totalLumpSum));

            return {
                lumpSum: Math.round(totalLumpSum),
                monthly: Math.round(monthlyDrawdown)
            };
        },

        calcGap: function(targetExpense, totalIncome, yearsToRetire, annualROI) {
            const monthlyGap = Math.max(0, targetExpense - totalIncome);
            if (monthlyGap === 0) return { gap: 0, neededSave: 0 };

            const safeMonthlyRate = this.CONSTANTS.SAFE_RATE / 12;
            const retireMonths = this.CONSTANTS.RETIRE_LIFE_YEARS * 12;
            const neededLumpSum = Math.abs(this.pv(safeMonthlyRate, retireMonths, monthlyGap));

            const investMonthlyRate = annualROI / 12;
            const monthsToInvest = yearsToRetire * 12;
            let neededSave = 0;
            
            if (monthsToInvest > 0) {
                neededSave = Math.abs(this.pmt(investMonthlyRate, monthsToInvest, 0, -neededLumpSum));
            } else {
                neededSave = neededLumpSum; 
            }

            return {
                gap: Math.round(monthlyGap),
                neededSave: Math.round(neededSave)
            };
        }
    };

    const App = {
        chart: null,

        init: function() {
            const range = document.getElementById('retireAge');
            const display = document.getElementById('retireAgeDisplay');
            range.addEventListener('input', (e) => {
                display.innerText = e.target.value + "æ­²";
            });

            document.getElementById('calcBtn').addEventListener('click', () => this.calculate());
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.calculate();
                });
            });

            this.calculate();
        },

        getVal: function(id) {
            return Number(document.getElementById(id).value) || 0;
        },

        fmt: function(num) {
            return new Intl.NumberFormat('zh-TW').format(num);
        },

        calculate: function() {
            const inputs = {
                age: this.getVal('age'),
                workYears: this.getVal('workYears'), // å‹ä¿å¹´è³‡
                salary: this.getVal('salary'),
                lpBalance: this.getVal('lpBalance'), // å‹é€€å°ˆæˆ¶é¤˜é¡ (æ–°æ¬„ä½)
                retireAge: this.getVal('retireAge'),
                targetExpense: this.getVal('targetExpense'),
                currentAssets: this.getVal('currentAssets'),
                monthlyInvest: this.getVal('monthlyInvest'),
                roi: this.getVal('roi') / 100
            };

            if (inputs.retireAge <= inputs.age) {
                alert("é€€ä¼‘å¹´é½¡å¿…é ˆå¤§æ–¼ç›®å‰å¹´é½¡ï¼");
                return;
            }
            
            const yearsToRetire = inputs.retireAge - inputs.age;

            // å‘¼å«å¼•æ“ - æ³¨æ„åƒæ•¸è®ŠåŒ–
            const li = PensionEngine.calcLaborInsurance(inputs.salary, inputs.workYears, inputs.age, inputs.retireAge);
            
            // é€™è£¡å‚³å…¥ inputs.lpBalance (ä»‹é¢ä¸Šå¡«çš„éŒ¢)ï¼Œè€Œä¸æ˜¯ inputs.workYears
            const lp = PensionEngine.calcLaborPension(inputs.salary, inputs.age, inputs.retireAge, inputs.lpBalance);
            
            const inv = PensionEngine.calcInvestment(inputs.currentAssets, inputs.monthlyInvest, yearsToRetire, inputs.roi);

            const totalIncome = li + lp.monthly + inv.monthly;
            const futureTarget = Math.round(inputs.targetExpense * Math.pow(1 + PensionEngine.CONSTANTS.INFLATION, yearsToRetire));
            const gapRes = PensionEngine.calcGap(futureTarget, totalIncome, yearsToRetire, inputs.roi);

            // æ›´æ–° UI
            document.getElementById('disp_li').innerText = this.fmt(li);
            document.getElementById('disp_lp').innerText = this.fmt(lp.monthly);
            document.getElementById('disp_lp_lump').innerText = this.fmt(lp.lumpSum);
            document.getElementById('disp_self').innerText = this.fmt(inv.monthly);
            document.getElementById('disp_totalIncome').innerText = this.fmt(totalIncome);
            document.getElementById('disp_target').innerText = this.fmt(futureTarget);

            // ç¼ºå£å¡ç‰‡é‚è¼¯ (çœç•¥æ¨£å¼ç´°ç¯€ï¼Œåƒ…æ›´æ–°æ–‡å­—)
            const gapCard = document.getElementById('gapCard');
            const gapTitle = document.getElementById('gapTitle');
            const gapDesc = document.getElementById('gapDesc');
            const gapIcon = document.getElementById('gapIcon');
            const dispSave = document.getElementById('disp_neededSave');

            if (gapRes.gap > 0) {
                gapCard.className = "mt-4 p-5 rounded-xl border transition-all duration-300 bg-red-50 border-red-200 text-red-900";
                gapIcon.innerText = "ğŸ˜Ÿ";
                gapTitle.innerText = `æ¯æœˆä»æœ‰ç¼ºå£ $${this.fmt(gapRes.gap)}`;
                gapDesc.innerText = "ä¾ç›®å‰çš„æº–å‚™ï¼Œé€€ä¼‘ç”Ÿæ´»å“è³ªå°‡ä½æ–¼é æœŸã€‚";
                dispSave.innerText = `$${this.fmt(gapRes.neededSave)}`;
                dispSave.parentElement.className = "bg-red-100 text-red-700 bg-white/50 px-4 py-2 rounded-lg text-right min-w-[160px]";
            } else {
                gapCard.className = "mt-4 p-5 rounded-xl border transition-all duration-300 bg-emerald-50 border-emerald-200 text-emerald-900";
                gapIcon.innerText = "ğŸ‰";
                gapTitle.innerText = "æ­å–œï¼å®Œç¾é”æ¨™";
                gapDesc.innerText = "æ‚¨çš„é€€ä¼‘æº–å‚™ç›¸ç•¶å……è£•ï¼Œå¯ç¶­æŒé æœŸç”Ÿæ´»æ°´æº–ã€‚";
                dispSave.innerText = "$0";
                dispSave.parentElement.className = "bg-emerald-100 text-emerald-700 bg-white/50 px-4 py-2 rounded-lg text-right min-w-[160px]";
            }

            this.renderChart(inputs.age, inputs.retireAge, inputs.currentAssets, inputs.monthlyInvest, inputs.roi);
        },

        renderChart: function(startAge, endAge, startAsset, monthlyAdd, annualRate) {
            const ctx = document.getElementById('growthChart').getContext('2d');
            const years = endAge - startAge;
            const monthlyRate = annualRate / 12;
            let labels = [], data = [], current = startAsset;

            for (let i = 0; i <= years; i++) {
                labels.push((startAge + i) + "æ­²");
                data.push(Math.round(current));
                if (i < years) {
                    for(let m=0; m<12; m++) current = current * (1 + monthlyRate) + monthlyAdd;
                }
            }

            if (this.chart) this.chart.destroy();

            this.chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'è‡ªä¸»è³‡ç”¢ç´¯ç© (ä¸å«æ”¿åºœå¹´é‡‘)',
                        data: data,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        pointRadius: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: true }, tooltip: { callbacks: { label: (c) => `è³‡ç”¢: ${new Intl.NumberFormat('zh-TW').format(c.raw)}` } } },
                    scales: { y: { ticks: { callback: (v) => (v/10000).toFixed(0) + 'è¬' }, grid: { borderDash: [4, 4] } }, x: { grid: { display: false } } }
                }
            });
        }
    };

    window.onload = () => App.init();
    </script>
</body>
</html>