<!DOCTYPE html>
<html lang="zh-TW" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../favicon.svg" type="image/svg+xml">
    <title>保險效益評估 (IRR/需求試算)｜TaiCalc</title>
    <meta name="description" content="全方位保險評估工具。儲蓄險 IRR 真實報酬率試算，協助判斷保單價值；壽險需求分析，精準計算家庭責任缺口與建議保額。">
    <link rel="canonical" href="https://taicalc.com/tools/insurance-assessment">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        stone: {
                            50: '#fafaf9',
                            800: '#292524',
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
</head>

<body class="bg-stone-50 text-stone-800 min-h-screen flex flex-col font-sans">
    <div id="app" v-cloak class="flex-grow max-w-2xl mx-auto w-full px-4 sm:px-6 py-8">

        <!-- Header / Global Nav -->
        <nav class="flex items-center justify-between mb-8">
            <a href="../index.html" class="flex items-center gap-2 group">
                <span
                    class="text-xl font-bold tracking-tight text-stone-800 group-hover:text-amber-600 transition-colors">TaiCalc</span>
            </a>
            <div class="flex gap-4 sm:gap-6 text-sm font-medium text-stone-500">
                <a href="../index.html" class="hover:text-stone-900 transition-colors">首頁</a>
                <a href="../categories/tools.html" class="hover:text-stone-900 transition-colors">工具</a>
            </div>
        </nav>

        <header class="mb-8">
            <div class="flex items-center justify-between mb-2">
                <h1 class="text-2xl sm:text-3xl font-bold text-stone-800 tracking-tight">保險效益評估</h1>
                <span
                    class="text-xs px-2.5 py-1 rounded-full bg-amber-100 text-amber-700 border border-amber-200 font-medium">IRR
                    / 需求分析</span>
            </div>
            <p class="text-stone-500 text-sm">真實呈現儲蓄險年化報酬率 (IRR)，與家庭壽險責任缺口分析。</p>
        </header>

        <main class="space-y-6">

            <div class="card bg-white rounded-2xl shadow-sm border border-stone-200 overflow-hidden">
                <!-- Tabs -->
                <div class="flex border-b border-stone-200">
                    <button @click="mode = 'irr'"
                        class="flex-1 py-3 text-sm font-bold text-center transition-colors relative"
                        :class="mode === 'irr' ? 'text-amber-600 bg-amber-50/50' : 'text-stone-500 hover:bg-stone-50'">
                        儲蓄險 IRR 試算
                        <div v-if="mode === 'irr'" class="absolute bottom-0 left-0 w-full h-0.5 bg-amber-600"></div>
                    </button>
                    <button @click="mode = 'needs'"
                        class="flex-1 py-3 text-sm font-bold text-center transition-colors relative"
                        :class="mode === 'needs' ? 'text-blue-600 bg-blue-50/50' : 'text-stone-500 hover:bg-stone-50'">
                        壽險需求分析
                        <div v-if="mode === 'needs'" class="absolute bottom-0 left-0 w-full h-0.5 bg-blue-600"></div>
                    </button>
                </div>

                <div class="p-6 space-y-6">

                    <!-- Tab 1: IRR Calculator -->
                    <div v-if="mode === 'irr'" class="space-y-6">
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-semibold text-stone-500 mb-1">繳費年期 (年)</label>
                                    <input type="number" v-model.number="irr.years" aria-label="繳費年期" placeholder="6"
                                        class="w-full bg-stone-50 border border-stone-200 rounded-xl py-3 px-4 text-stone-800 font-bold focus:outline-none focus:ring-2 focus:ring-amber-500/20 focus:border-amber-500">
                                </div>
                                <div>
                                    <label class="block text-xs font-semibold text-stone-500 mb-1">年繳保費</label>
                                    <input type="number" v-model.number="irr.premium" aria-label="年繳保費"
                                        placeholder="100000"
                                        class="w-full bg-stone-50 border border-stone-200 rounded-xl py-3 px-4 text-stone-800 font-bold focus:outline-none focus:ring-2 focus:ring-amber-500/20 focus:border-amber-500">
                                </div>
                            </div>

                            <div>
                                <label class="block text-xs font-semibold text-stone-500 mb-1">期滿解約/領回金額 (第N年末)</label>
                                <div class="flex gap-2">
                                    <input type="number" v-model.number="irr.endYear" aria-label="領回年度"
                                        placeholder="第幾年領回? (如: 6)"
                                        class="w-24 bg-stone-50 border border-stone-200 rounded-xl py-3 px-4 text-stone-800 font-bold focus:outline-none focus:ring-2 focus:ring-amber-500/20 focus:border-amber-500">
                                    <input type="number" v-model.number="irr.cashValue" aria-label="領回金額"
                                        placeholder="解約金金額"
                                        class="flex-1 bg-stone-50 border border-stone-200 rounded-xl py-3 px-4 text-stone-800 font-bold focus:outline-none focus:ring-2 focus:ring-amber-500/20 focus:border-amber-500">
                                </div>
                                <p class="text-[10px] text-stone-400 mt-1">請輸入您預計在哪一年解約或滿期領回，以及當時的「年度末解約金」。</p>
                            </div>
                        </div>

                        <!-- Result -->
                        <div class="pt-4 border-t border-stone-100">
                            <div
                                class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl p-6 text-center border border-amber-100">
                                <p class="text-xs text-amber-700 uppercase tracking-wide mb-1">內部報酬率 (IRR)</p>
                                <div class="flex items-baseline justify-center gap-2">
                                    <span class="text-4xl font-bold font-mono text-amber-700">{{ irrResult }}</span>
                                    <span class="text-sm font-bold text-amber-700">%</span>
                                </div>
                                <p class="text-xs text-amber-600/70 mt-2">
                                    比起定存 (約1.7%)：
                                    <span v-if="irrValue > 1.7" class="font-bold text-green-600">優於定存</span>
                                    <span v-else class="font-bold text-red-500">低於定存</span>
                                </p>
                            </div>
                            <div class="mt-4 text-xs text-stone-400">
                                <p>計算說明：假設保費於每年年初繳納，解約金於該年度末領回。</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tab 2: Needs Analysis -->
                    <div v-if="mode === 'needs'" class="space-y-6">

                        <!-- Liabilities -->
                        <div class="space-y-3">
                            <h3 class="text-sm font-bold text-stone-700 border-l-4 border-blue-500 pl-2">1. 家庭責任 (負債與開銷)
                            </h3>
                            <div class="grid grid-cols-1 gap-3">
                                <div>
                                    <label class="block text-xs font-semibold text-stone-500 mb-1">房貸與其他負債餘額</label>
                                    <input type="number" v-model.number="needs.debt" aria-label="負債餘額"
                                        class="w-full bg-stone-50 border border-stone-200 rounded-lg py-2 px-3 focus:outline-none focus:ring-1 focus:ring-blue-500">
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-xs font-semibold text-stone-500 mb-1">家庭年支出
                                            (不含房貸)</label>
                                        <input type="number" v-model.number="needs.expenses" aria-label="家庭年支出"
                                            class="w-full bg-stone-50 border border-stone-200 rounded-lg py-2 px-3 focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-semibold text-stone-500 mb-1">預留年數</label>
                                        <select v-model.number="needs.years" aria-label="預留年數"
                                            class="w-full bg-stone-50 border border-stone-200 rounded-lg py-2 px-3 focus:outline-none focus:ring-1 focus:ring-blue-500">
                                            <option value="5">5年 (緩衝期)</option>
                                            <option value="10">10年 (子女成年前)</option>
                                            <option value="20">20年 (長期照顧)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Assets -->
                        <div class="space-y-3">
                            <h3 class="text-sm font-bold text-stone-700 border-l-4 border-green-500 pl-2">2. 現有資產</h3>
                            <div>
                                <label class="block text-xs font-semibold text-stone-500 mb-1">存款與投資總額</label>
                                <input type="number" v-model.number="needs.assets" aria-label="現有資產"
                                    class="w-full bg-stone-50 border border-stone-200 rounded-lg py-2 px-3 focus:outline-none focus:ring-1 focus:ring-green-500">
                            </div>
                        </div>

                        <!-- Result -->
                        <div class="pt-4 border-t border-stone-100">
                            <div class="bg-stone-50 rounded-xl p-6 border border-stone-200 text-center">
                                <p class="text-xs text-stone-500 uppercase tracking-wide mb-1">建議壽險保額 (責任缺口)</p>
                                <p class="text-3xl font-bold font-mono tracking-tight"
                                    :class="needsResult > 0 ? 'text-blue-600' : 'text-green-600'">
                                    {{ needsResult > 0 ? '$' + fmt(needsResult) : '資產已足夠' }}
                                </p>
                                <p class="text-sm text-stone-500 mt-2" v-if="needsResult > 0">
                                    (負債 + 家庭支出) - 現有資產 = 需補足的保障
                                </p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>

        <footer class="text-center mt-12 text-stone-400 text-sm pb-8">
            <p class="mb-2">© 2026 TaiCalc</p>
            <a href="mailto:service@taicalc.com"
                class="text-xs text-stone-300 hover:text-stone-500 transition-colors">回報問題 (Report Issue)</a>
        </footer>
    </div>

    <script>
        const { createApp, ref, computed } = Vue

        createApp({
            setup() {
                const mode = ref('irr') // irr, needs

                // IRR Data
                const irr = ref({
                    years: 6,
                    premium: 100000,
                    endYear: 6,
                    cashValue: 610000
                })

                // Needs Data
                const needs = ref({
                    debt: 5000000, // 500萬房貸
                    expenses: 600000, // 60萬/年
                    years: 10,
                    assets: 2000000
                })

                const fmt = (n) => n ? Math.round(n).toLocaleString('zh-TW') : '0'

                // Logic: IRR Calculation (Newton-Raphson)
                const calculateIRR = (cashFlows) => {
                    // cashFlows: array of { year, amount }. Amount is negative for outflow (premium), positive for inflow (cash value).
                    // NPV = sum( amount / (1+r)^year )
                    // We want r where NPV = 0.

                    let guess = 0.01 // Start with 1%
                    const maxIter = 50
                    const tolerance = 0.00001

                    for (let i = 0; i < maxIter; i++) {
                        let npv = 0
                        let derivative = 0

                        for (let cf of cashFlows) {
                            // NPV
                            npv += cf.amount / Math.pow(1 + guess, cf.year)
                            // Derivative of NPV with respect to r
                            // d/dr (A * (1+r)^-t) = A * -t * (1+r)^(-t-1)
                            derivative += -cf.year * cf.amount * Math.pow(1 + guess, -cf.year - 1)
                        }

                        if (Math.abs(npv) < tolerance) return guess

                        if (derivative === 0) return null // failed
                        const newGuess = guess - npv / derivative
                        if (Math.abs(newGuess - guess) < tolerance) return newGuess
                        guess = newGuess
                    }
                    return guess
                }

                const irrValue = computed(() => {
                    // Construct Cash Flows
                    // Assumption: Premium paid at START of year (t=0, 1, 2...)
                    // Cash Value received at END of year (t=endYear)
                    // If endYear is 6, usually means end of 6th year. 
                    // Premium paid for `irr.years` times.

                    const flows = []
                    const p = irr.value.premium || 0
                    const payYears = irr.value.years || 0
                    const endY = irr.value.endYear || 0
                    const val = irr.value.cashValue || 0

                    if (p <= 0 || val <= 0 || endY <= 0) return 0

                    // Outflows (Premiums)
                    // Paid at Year 0, 1, ... (payYears-1)
                    // NOTE: If paying for 6 years, usually pay at t=0, 1, 2, 3, 4, 5.
                    for (let t = 0; t < payYears; t++) {
                        // If we surrender before payment done? 
                        // Usually user inputs "End Year > Pay Years". 
                        // But logic holds: cash flow happens at t.
                        if (t < endY) { // Only pay if year < surrender year? Usually yes.
                            flows.push({ year: t, amount: -p })
                        }
                    }

                    // Inflow (Surrender Value)
                    // At END of endYear. Wait, "End of Year N" is effectively t=N.
                    // E.g. End of Year 1 = t=1.
                    flows.push({ year: endY, amount: val })

                    const r = calculateIRR(flows)
                    return r ? (r * 100) : 0
                })

                const irrResult = computed(() => {
                    const v = irrValue.value
                    if (v === null || isNaN(v) || !isFinite(v)) return '---'
                    return v.toFixed(2)
                })

                // Logic: Needs
                const needsResult = computed(() => {
                    const totalLiability = (needs.value.debt || 0) + (needs.value.expenses || 0) * (needs.value.years || 0)
                    const assets = needs.value.assets || 0
                    const gap = totalLiability - assets
                    return gap > 0 ? gap : 0
                })

                return {
                    mode, irr, needs, fmt,
                    irrResult, irrValue, needsResult
                }
            }
        }).mount('#app')
    </script>
</body>

</html>