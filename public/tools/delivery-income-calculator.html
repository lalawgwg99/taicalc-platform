<!DOCTYPE html>
<html lang="zh-TW" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../favicon.svg" type="image/svg+xml">
    <title>外送收入計算｜TaiCalc</title>
    <meta name="description" content="計算外送平台實際收入，扣除油錢、機車折舊後的淨所得。">
    <link rel="canonical" href="https://taicalc.com/tools/delivery-income">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        stone: {
                            50: '#fafaf9',
                            800: '#292524',
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="../css/style.css">
</head>

<body class="bg-stone-50 text-stone-800 min-h-screen flex flex-col font-sans">
    <div id="app" v-cloak class="flex-grow max-w-2xl mx-auto w-full px-4 sm:px-6 py-8">

        <!-- Header / Global Nav -->
        <nav class="flex items-center justify-between mb-8">
            <a href="../index.html" class="flex items-center gap-2 group">
                <span
                    class="text-xl font-bold tracking-tight text-stone-800 group-hover:text-amber-600 transition-colors">TaiCalc</span>
            </a>
            <div class="flex gap-4 sm:gap-6 text-sm font-medium text-stone-500">
                <a href="../dashboard.html"
                    class="text-emerald-600 font-bold hover:text-emerald-700 transition-colors">生活儀表板</a>
                <a href="../index.html" class="hover:text-stone-900 transition-colors">首頁</a>
                <a href="../categories/finance.html" class="hover:text-stone-900 transition-colors">退休理財</a>
                <a href="../categories/life.html" class="hover:text-stone-900 transition-colors">生活</a>
                <a href="../categories/tools.html" class="hover:text-stone-900 transition-colors">工具</a>
            </div>
        </nav>

        <!-- Breadcrumb -->
        <div class="text-sm text-stone-500 mb-6 flex items-center gap-2">
            <a href="../index.html" class="hover:text-stone-800 transition-colors">首頁</a>
            <span>/</span>
            <a href="../categories/tools.html" class="hover:text-stone-800 transition-colors">實用工具</a>
            <span>/</span>
            <span class="text-stone-900 font-medium">外送收入</span>
        </div>

        <header class="mb-8">
            <div class="flex items-center justify-between mb-2">
                <h1 class="text-2xl sm:text-3xl font-bold text-stone-800 tracking-tight">外送收入計算</h1>
                <span
                    class="text-xs px-2.5 py-1 rounded-full bg-emerald-100 text-emerald-700 border border-emerald-200 font-medium">淨利試算</span>
            </div>
            <p class="text-stone-500 text-sm">扣除油錢、保養後的實際時薪</p>
        </header>

        <main class="space-y-6">
            <!-- 輸入區塊 -->
            <div class="grid lg:grid-cols-2 gap-6">
                <section class="card bg-white rounded-2xl p-6 shadow-sm border border-stone-200">
                    <h2 class="text-lg font-bold text-stone-800 mb-4 flex items-center gap-2">💰 收入與工時</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="grossIncome" class="block text-xs font-medium text-stone-500 mb-1">每月總收入
                                (跑單金額+獎勵)</label>
                            <input id="grossIncome" type="number" v-model.number="grossIncome"
                                class="w-full bg-stone-50 border border-stone-200 rounded-xl py-2.5 px-3 text-stone-800 text-lg font-bold focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="kilometers" class="block text-xs font-medium text-stone-500 mb-1">總里程
                                    (KM)</label>
                                <input id="kilometers" type="number" v-model.number="kilometers"
                                    class="w-full bg-stone-50 border border-stone-200 rounded-xl py-2 px-3 text-stone-800 font-semibold focus:outline-none focus:border-emerald-500">
                            </div>
                            <div>
                                <label for="workHours" class="block text-xs font-medium text-stone-500 mb-1">總工時
                                    (H)</label>
                                <input id="workHours" type="number" v-model.number="workHours"
                                    class="w-full bg-stone-50 border border-stone-200 rounded-xl py-2 px-3 text-stone-800 font-semibold focus:outline-none focus:border-emerald-500">
                            </div>
                        </div>
                    </div>
                </section>

                <section class="card bg-white rounded-2xl p-6 shadow-sm border border-stone-200">
                    <h2 class="text-lg font-bold text-stone-800 mb-4 flex items-center gap-2">🛵 車輛與隱性成本</h2>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="gasPrice" class="block text-xs font-medium text-stone-500 mb-1">油價
                                    ($/L)</label>
                                <input id="gasPrice" type="number" v-model.number="gasPrice"
                                    class="w-full bg-stone-50 border border-stone-200 rounded-xl py-2 px-3 text-stone-800 focus:outline-none focus:border-emerald-500">
                            </div>
                            <div>
                                <label for="kmPerLiter" class="block text-xs font-medium text-stone-500 mb-1">油耗
                                    (KM/L)</label>
                                <input id="kmPerLiter" type="number" v-model.number="kmPerLiter"
                                    class="w-full bg-stone-50 border border-stone-200 rounded-xl py-2 px-3 text-stone-800 focus:outline-none focus:border-emerald-500">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="maintenancePerKm"
                                    class="block text-xs font-medium text-stone-500 mb-1">每公里保養 (機油/輪胎..)</label>
                                <div class="relative">
                                    <input id="maintenancePerKm" type="number" v-model.number="maintenancePerKm"
                                        step="0.1"
                                        class="w-full bg-stone-50 border border-stone-200 rounded-xl py-2 px-3 text-stone-800 focus:outline-none focus:border-emerald-500 pl-8">
                                    <span class="absolute left-3 top-2 text-stone-400">$</span>
                                </div>
                            </div>
                            <div>
                                <label for="otherMonthlyCost"
                                    class="block text-xs font-medium text-stone-500 mb-1">其他月開銷 (保險/稅/費)</label>
                                <div class="relative">
                                    <input id="otherMonthlyCost" type="number" v-model.number="otherMonthlyCost"
                                        class="w-full bg-stone-50 border border-stone-200 rounded-xl py-2 px-3 text-stone-800 focus:outline-none focus:border-emerald-500 pl-8">
                                    <span class="absolute left-3 top-2 text-stone-400">$</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- 結果儀表板 -->
            <div class="grid md:grid-cols-2 gap-6">
                <!-- 核心數據 -->
                <section
                    class="card bg-emerald-50 rounded-2xl p-6 border border-emerald-100 flex flex-col justify-between relative overflow-hidden">
                    <div
                        class="absolute right-0 top-0 w-32 h-32 bg-emerald-100 rounded-full blur-3xl -mr-10 -mt-10 opacity-60">
                    </div>

                    <div class="relative z-10">
                        <p class="text-sm font-bold text-emerald-800 mb-1">實質淨收入 (Net Income)</p>
                        <p class="text-4xl font-extrabold text-emerald-600 tracking-tight mb-2">
                            <span class="text-2xl opacity-70">$</span>{{ netIncome }}
                        </p>
                        <div class="flex items-center gap-3 text-sm">
                            <span class="bg-white/60 px-2 py-1 rounded text-emerald-700 font-medium">實薪 ${{ hourlyRate
                                }}</span>
                            <span class="bg-white/60 px-2 py-1 rounded text-emerald-700 font-medium">${{ perKm
                                }}/km</span>
                        </div>
                    </div>

                    <div class="relative z-10 pt-6 mt-6 border-t border-emerald-200/60 grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-xs text-emerald-600 mb-1">總成本佔比</p>
                            <p class="text-lg font-bold text-emerald-800">{{ costRatio }}%</p>
                        </div>
                        <div>
                            <p class="text-xs text-emerald-600 mb-1">預估稅前獲利</p>
                            <p class="text-lg font-bold text-emerald-800">{{ profitMargin }}%</p>
                        </div>
                    </div>
                </section>

                <!-- 成本結構圖表 -->
                <section class="card bg-white rounded-2xl p-6 shadow-sm border border-stone-200 flex items-center">
                    <div class="w-1/2">
                        <h3 class="text-sm font-bold text-stone-700 mb-4">成本結構分析</h3>
                        <ul class="space-y-2 text-xs">
                            <li class="flex justify-between">
                                <span class="flex items-center gap-1"><span
                                        class="w-2 h-2 rounded-full bg-rose-400"></span>油錢</span>
                                <span class="font-mono text-stone-600">${{ gasCost }}</span>
                            </li>
                            <li class="flex justify-between">
                                <span class="flex items-center gap-1"><span
                                        class="w-2 h-2 rounded-full bg-orange-400"></span>保養耗材</span>
                                <span class="font-mono text-stone-600">${{ maintenanceTotal }}</span>
                            </li>
                            <li class="flex justify-between">
                                <span class="flex items-center gap-1"><span
                                        class="w-2 h-2 rounded-full bg-gray-400"></span>固定開銷</span>
                                <span class="font-mono text-stone-600">${{ otherMonthlyCost }}</span>
                            </li>
                            <li
                                class="pt-2 mt-2 border-t border-dashed border-stone-100 flex justify-between font-bold">
                                <span class="text-stone-700">總成本</span>
                                <span class="text-rose-500">-${{ totalCost }}</span>
                            </li>
                        </ul>
                    </div>
                    <div class="w-1/2 flex justify-center">
                        <div class="chart-container w-32 h-32 relative">
                            <canvas ref="chartCanvas"></canvas>
                        </div>
                    </div>
                </section>
            </div>

            <div class="text-center text-xs text-stone-400 mt-8">
                💡 建議：每公里保養成本 (機油/輪胎/傳動) 一般速克達約在 $0.5 ~ $1.5 之間。
            </div>
        </main>

        <footer class="text-center mt-12 text-stone-400 text-sm pb-8">
            © 2026 TaiCalc
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const { createApp, ref, computed, watch, onMounted } = Vue

        createApp({
            setup() {
                const grossIncome = ref(0)
                const kilometers = ref(0)
                const gasPrice = ref(30) // Reasonable default
                const kmPerLiter = ref(35) // Reasonable default
                const workHours = ref(0)
                const maintenancePerKm = ref(0.8) // 每公里保養費(輪胎機油)
                const otherMonthlyCost = ref(0) // 強制險+任意險攤提+稅

                const chartCanvas = ref(null)
                let chartInstance = null

                // 計算屬性
                const gasCostRaw = computed(() => (kilometers.value / kmPerLiter.value) * gasPrice.value)
                const maintenanceTotalRaw = computed(() => kilometers.value * maintenancePerKm.value)

                const gasCost = computed(() => Math.round(gasCostRaw.value).toLocaleString())
                const maintenanceTotal = computed(() => Math.round(maintenanceTotalRaw.value).toLocaleString())

                const totalCostRaw = computed(() => gasCostRaw.value + maintenanceTotalRaw.value + otherMonthlyCost.value)
                const totalCost = computed(() => Math.round(totalCostRaw.value).toLocaleString())

                const netIncomeRaw = computed(() => grossIncome.value - totalCostRaw.value)
                const netIncome = computed(() => Math.round(netIncomeRaw.value).toLocaleString())

                const hourlyRate = computed(() => workHours.value > 0 ? Math.round(netIncomeRaw.value / workHours.value) : 0)
                const perKm = computed(() => kilometers.value > 0 ? Math.round((netIncomeRaw.value / kilometers.value) * 10) / 10 : 0)

                const costRatio = computed(() => grossIncome.value > 0 ? Math.round((totalCostRaw.value / grossIncome.value) * 100) : 0)
                const profitMargin = computed(() => grossIncome.value > 0 ? Math.round((netIncomeRaw.value / grossIncome.value) * 100) : 0)

                // 圖表
                const updateChart = () => {
                    if (!chartCanvas.value) return
                    if (chartInstance) chartInstance.destroy()

                    const net = Math.max(0, netIncomeRaw.value)
                    const gas = gasCostRaw.value
                    const maint = maintenanceTotalRaw.value + otherMonthlyCost.value

                    chartInstance = new Chart(chartCanvas.value, {
                        type: 'doughnut',
                        data: {
                            labels: ['淨收入', '油錢', '保養雜支'],
                            datasets: [{
                                data: [net, gas, maint],
                                backgroundColor: ['#10b981', '#fb7185', '#fb923c'], // Emerald-500, Rose-400, Orange-400
                                borderWidth: 0,
                                hoverOffset: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            cutout: '70%',
                            plugins: {
                                legend: { display: false },
                                tooltip: { enabled: false } // 簡化
                            }
                        }
                    })
                }

                // Persistence
                onMounted(() => {
                    const saved = localStorage.getItem('taicalc_delivery_inputs')
                    if (saved) {
                        try {
                            const data = JSON.parse(saved)
                            if (data.grossIncome) grossIncome.value = data.grossIncome
                            if (data.kilometers) kilometers.value = data.kilometers
                            if (data.gasPrice) gasPrice.value = data.gasPrice
                            if (data.kmPerLiter) kmPerLiter.value = data.kmPerLiter
                            if (data.workHours) workHours.value = data.workHours
                            if (data.maintenancePerKm) maintenancePerKm.value = data.maintenancePerKm
                            if (data.otherMonthlyCost) otherMonthlyCost.value = data.otherMonthlyCost
                        } catch (e) { }
                    }
                    setTimeout(updateChart, 100)
                })

                watch([grossIncome, kilometers, gasPrice, kmPerLiter, workHours, maintenancePerKm, otherMonthlyCost], (vals) => {
                    updateChart()
                    localStorage.setItem('taicalc_delivery_inputs', JSON.stringify({
                        grossIncome: vals[0], kilometers: vals[1], gasPrice: vals[2],
                        kmPerLiter: vals[3], workHours: vals[4], maintenancePerKm: vals[5],
                        otherMonthlyCost: vals[6]
                    }))
                })

                // Auto-save for Dashboard
                watch(netIncome, (newVal) => {
                    const val = parseInt(newVal.replace(/,/g, ''))
                    if (val > 0) {
                        localStorage.setItem('taicalc_delivery_net', val)
                    }
                })

                return {
                    grossIncome, kilometers, gasPrice, kmPerLiter, workHours, maintenancePerKm, otherMonthlyCost,
                    gasCost, maintenanceTotal, totalCost, netIncome, hourlyRate, perKm, costRatio, profitMargin,
                    chartCanvas
                }
            }
        }).mount('#app')
    </script>
</body>

</html>